<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">

<dom-module id="news-list">
	<template>
		<style>
        iron-list {
            height: 100%;
            overflow: auto;
        }
		.item {
			overflow: hidden;
			padding: 20px;
			display: block;
			background-color: white;
			border-bottom: 1px #cccccc solid;
		}
		.time{
			display: block;
			margin-top: 18px;
			font-size: 0.7rem;
			font-weight: 300;
            text-align: right;
		}
		.item:hover{
			background: #e0e0e0;
		}
		</style>

        <iron-ajax id="ajax" url="/content/news.json" auto on-response="_responseHandler" handleAs="json"></iron-ajax>
        <iron-list id="news-list" as="news">
            <template>
                <div>
                    <div class="item">
                        <div class="news-content zh-TW-content">[[news.zh-TW]]</div>
                        <div class="news-content en-US-content">[[news.en-US]]</div>
                        <div class="time">[[news.time]]</div>
                    </div>
                </div>
            </template>
        </iron-list>
	</template>

    <script>
        Polymer({
            is: 'news-list',
            properties: {
                languages: {
                    type: String,
                    observer: '_languageChanged'
                },
                focus:{
                    type: Boolean,
                    observer: '_focusChanged'
                }
            },
            _responseHandler: function(e){
                var data = e.detail.response;
                this.$$("#news-list").items = data;
            },
            _focusChanged: function(newValue, oldValue){
                if(newValue){
                    this.$$("#news-list").fire('resize');
                    this._changeLanguage(this.languages);
                }
            },
            _languageChanged: function(newLanguage, oldLanguage){
                this.$$("#news-list").fire('resize'); // 排版才會正常
                this._changeLanguage(newLanguage);
            },
            _changeLanguage: function(language){
                var zhTWContent = Polymer.dom(this.root).querySelectorAll(".zh-TW-content");
                var enUSContent = Polymer.dom(this.root).querySelectorAll(".en-US-content");
                if(language === "zh-TW"){
                    zhTWContent.forEach(function(element){
                        element.style.display = '';
                    });
                    enUSContent.forEach(function(element){
                        element.style.display = 'none';
                    });
                }
                else{
                    zhTWContent.forEach(function(element){
                        element.style.display = 'none';
                    });
                    enUSContent.forEach(function(element){
                        element.style.display = '';
                    });
                }
            }
        });
    </script>
</dom-module>