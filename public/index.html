<!doctype html>
<html>
	<head>
		<title>MITLAB</title>
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
		<link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700' rel='stylesheet' type='text/css'>
        <link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
        <link rel="import" href="bower_components/iron-icons/iron-icons.html">
        <link rel="import" href="bower_components/iron-icons/communication-icons.html">
        <link rel="import" href="bower_components/iron-icons/image-icons.html">
        <link rel="import" href="bower_components/iron-icons/social-icons.html">
		<link rel="import" href="bower_components/iron-icons/av-icons.html">
        <link rel="import" href="bower_components/iron-icon/iron-icon.html">
        <link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
        <link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
        <link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
        <link rel="import" href="bower_components/paper-menu/paper-menu.html">
        <link rel="import" href="bower_components/paper-item/paper-icon-item.html">
        <link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
		<link rel="import" href="bower_components/paper-ripple/paper-ripple.html">
		<link rel="import" href="bower_components/paper-fab-transitions/paper-fab-speed-dial.html">
		<link rel="import" href="custom_components/lab-content.html">

		<style>
		html, body {
			font-family: 'Noto Sans', sans-serif;
		}
		a{
			text-decoration: none;
		}
		paper-header-panel {
			height: 100%;
			background-color: #ffffff;
		}
		#header-title{
			font-size: 0.8em;
		}
		#nav-header {
			background-color: #000000;
			color: #ffffff;
            font-size: 1.6rem;
            font-weight: 700;
		}
		#main-header {
			background-color: #00bcd4;
			color: #ffffff;
			font-weight: 500;
			font-size: 150%;
		}
		paper-drawer-panel:not([narrow]) #navicon {
			display: none;
		}
        .menu-item{
            cursor: default;
            margin-bottom: 20px;
        }
		.menu-item-text{
			font-size: 120%;
		}
		#switch-languages-button{
			position: absolute;
			bottom: 5px;
			left: 5px;
		}
		</style>

		<style is="custom-style">
			.small-icons {
				--iron-icon-height: 24px;
				--iron-icon-width: 24px;
			}
		</style>

		<script>
            HTMLImports.whenReady(function() {
				var paperDrawerPanel = document.querySelector('paper-drawer-panel');
				var labContent = document.querySelector('lab-content');
                var headerTitle = document.querySelector('#header-title');
				var drawerPanel = document.querySelector('#drawerPanel');
				var menuItem = document.querySelectorAll('.menu-item');
                var menuItemText = document.querySelectorAll('.menu-item-text');
				var navIcon = document.querySelector('#navicon');
				var detectLangAjax = document.querySelector('#detect-language-ajax');
				var switchLangAjax = document.querySelector('#switch-language-ajax');
				var slb = document.querySelector('#switch-languages-button');
				var currentLang;

				function setContent(content){
					currentLanguage = content["language"];
					var menu = content["menu"].replace('[', '').replace(']', '').replace(/\'/g, '').split(',');
					for(var i= 0; i < menuItemText.length; i++){
						menuItemText[i].textContent = menu[i];
					}
					labContent.content = content;
				}

				function init(){
					for(var i = 0; i < menuItem.length; i++){
						menuItem[i].addEventListener('click', function() {
							paperDrawerPanel.togglePanel();
							var currentPage = this.getAttribute("data-menu");
							labContent.setAttribute('page', currentPage);
						});
					}

					detectLangAjax.addEventListener('response', function(e){
						var content = e.detail.response;
						setContent(content);
					});

					switchLangAjax.addEventListener('response', function(e){
						var content = e.detail.response;
						setContent(content);
					});

					navIcon.addEventListener('click', function() {
						drawerPanel.togglePanel();
					});

					labContent.addEventListener('pageChanged', function(e){
						var page = e.detail.page;
						var pageText;
						for(var i = 0; i < menuItem.length; i++){
							if(page === menuItem[i].getAttribute("data-menu")){
								pageText = menuItem[i].querySelector(".menu-item-text").textContent;
								break;
							}
						}
						headerTitle.textContent = pageText;
					});

					slb.addEventListener('click', function(e) {
						currentLang = (currentLang === "en-US") ? "zh-TW" : "en-US";
						data = {"lang": currentLang};
						switchLangAjax.params = data;
						switchLangAjax.generateRequest();
					});
				}

				init();

			});
		</script>
	</head>

	<body>
		<iron-ajax id="detect-language-ajax" auto url="detectlanguage" handleAs="json"></iron-ajax>
		<iron-ajax id="switch-language-ajax" url="switchlanguage" handleAs="json"></iron-ajax>

		<paper-drawer-panel id="drawerPanel" responsive-width="800px">
			<paper-header-panel drawer mode="seamed">
				<paper-toolbar id="nav-header">
                    <div>MITLAB</div>
                </paper-toolbar>

				<paper-menu selected="0">
					<paper-icon-item class="menu-item" data-menu="about">
                        <div class="menu-item-text"></div>
                        <iron-icon icon="info" item-icon></iron-icon>
                    </paper-icon-item>
                    <paper-icon-item class="menu-item" data-menu="news">
                        <div class="menu-item-text"></div>
                        <iron-icon icon="event" item-icon></iron-icon>
                    </paper-icon-item>
                    <paper-icon-item class="menu-item" data-menu="professor">
                        <div class="menu-item-text"></div>
                        <iron-icon icon="image:portrait" item-icon></iron-icon>
                    </paper-icon-item>
                    <paper-icon-item class="menu-item" data-menu="members">
                        <div class="menu-item-text"></div>
                        <iron-icon icon="social:group" item-icon></iron-icon>
                    </paper-icon-item>
                    <paper-icon-item class="menu-item" data-menu="publications">
                        <div class="menu-item-text"></div>
                        <iron-icon icon="av:library-books" item-icon></iron-icon>
                    </paper-icon-item>
                    <paper-icon-item class="menu-item" data-menu="projects">
                        <div class="menu-item-text"></div>
                        <iron-icon icon="work" item-icon></iron-icon>
                    </paper-icon-item>
                    <paper-icon-item class="menu-item" data-menu="contact">
                        <div class="menu-item-text"></div>
                        <iron-icon icon="communication:contacts" item-icon></iron-icon>
                    </paper-icon-item>
				</paper-menu>
				<paper-icon-button id="switch-languages-button" class="small-icons" icon="social:public"></paper-icon-button>
			</paper-header-panel>

			<paper-header-panel main mode="seamed">
				<paper-toolbar id="main-header">
					<paper-icon-button id="navicon" icon="menu"></paper-icon-button>
					<div id="header-title"></div>
				</paper-toolbar>
                <lab-content></lab-content>
			</paper-header-panel>
		</paper-drawer-panel>
	</body>
</html>
